# 平台模板管理功能测试指南

## 测试环境

- 开发服务器: http://localhost:5175/
- 状态: ✅ 运行正常

## 功能测试清单

### Phase 1: 基础功能 ✅

#### 1. 新增自定义预设

**测试步骤:**
1. 打开应用 http://localhost:5175/
2. 在"快速选择平台"区域,找到"+"按钮(虚线边框卡片)
3. 点击"+"按钮,应该弹出"添加平台预设"对话框
4. 输入测试数据:
   - 平台名称: `测试平台`
   - API 地址: `https://api.test.com`
5. 点击"保存"
6. 验证新预设出现在网格中

**预期结果:**
- ✅ 对话框正常弹出
- ✅ 表单验证正常工作
- ✅ 保存后预设显示在网格中
- ✅ 刷新页面后数据持久化

---

#### 2. 编辑预设

**测试场景 A: 编辑内置预设**
1. Hover 鼠标到"OpenAI 官方"预设卡片
2. 应该显示"编辑"和"删除"按钮
3. 点击"编辑"按钮
4. 修改名称为 `OpenAI (自定义)`
5. 保存

**预期结果:**
- ✅ Hover 时操作按钮可见
- ✅ 对话框预填充现有数据
- ✅ 保存后名称更新
- ✅ 内置预设修改记录到 `builtInOverrides`

**测试场景 B: 编辑自定义预设**
1. 找到之前创建的"测试平台"
2. 点击"编辑"按钮
3. 修改 URL 为 `https://api.test2.com`
4. 保存

**预期结果:**
- ✅ URL 更新成功
- ✅ 自定义预设直接修改

---

#### 3. 删除预设

**测试场景 A: 删除内置预设**
1. Hover 到"硅基流动"预设
2. 点击"删除"按钮
3. 确认删除对话框

**预期结果:**
- ✅ 确认对话框显示
- ✅ 确认后预设消失
- ✅ 内置预设标记为 `deleted`
- ✅ 刷新页面后仍然被删除

**测试场景 B: 删除自定义预设**
1. 删除"测试平台"预设
2. 确认删除

**预期结果:**
- ✅ 预设从列表移除
- ✅ 从 `custom` 数组中删除

---

#### 4. 恢复默认预设

**测试步骤:**
1. 修改/删除几个内置预设后
2. 注意"恢复默认预设"链接应该显示在右上角
3. 点击"恢复默认预设"
4. 确认对话框

**预期结果:**
- ✅ 所有内置预设恢复到初始状态
- ✅ 自定义预设保留不变
- ✅ `builtInOverrides` 清空
- ✅ 恢复后链接消失(如果没有 override)

---

### Phase 2: 验证测试

#### 1. 重名检测

**测试步骤:**
1. 点击"+"新增预设
2. 输入已存在的名称(如 "OpenAI 官方")
3. 观察错误提示

**预期结果:**
- ✅ 显示 "该名称已存在" 错误
- ✅ 保存按钮禁用

---

#### 2. URL 验证

**测试场景 A: 无效 URL 格式**
1. 新增预设,输入 URL: `http://api.test.com` (http 而非 https)
2. 观察错误

**预期结果:**
- ✅ 显示 "API 地址必须以 https:// 开头"
- ✅ 保存按钮禁用

**测试场景 B: 格式错误**
1. 输入 URL: `not-a-url`
2. 观察错误

**预期结果:**
- ✅ 显示 "URL 格式无效"
- ✅ 保存按钮禁用

---

#### 3. 必填字段验证

**测试步骤:**
1. 打开新增对话框
2. 仅输入名称,不输入 URL
3. 尝试保存

**预期结果:**
- ✅ 显示 "请输入 API 地址" 错误
- ✅ 保存按钮禁用

---

### Phase 3: UI/UX 测试

#### 1. 响应式布局

**桌面端 (> 1024px):**
- ✅ 网格显示 3 列
- ✅ Hover 操作按钮正常显示

**平板端 (768px - 1024px):**
- ✅ 网格显示 2 列
- ✅ 触摸操作正常

**移动端 (< 768px):**
- ✅ 网格显示 1 列
- ✅ 对话框适配小屏幕

---

#### 2. 动画与过渡

**测试项:**
- ✅ 对话框打开/关闭动画流畅
- ✅ Hover 操作按钮淡入淡出
- ✅ 边框颜色过渡

---

### Phase 4: 数据持久化测试

#### 1. LocalStorage 验证

**测试步骤:**
1. 打开浏览器开发工具 (F12)
2. 进入 Application → Local Storage → http://localhost:5175
3. 查找 `platform-presets` 键

**预期数据结构:**
```json
{
  "custom": [
    {
      "id": "1707012345-abc123",
      "name": "测试平台",
      "url": "https://api.test.com",
      "isBuiltIn": false
    }
  ],
  "builtInOverrides": {
    "OpenAI 官方": {
      "name": "OpenAI (自定义)",
      "url": "https://api.openai.com"
    },
    "硅基流动": {
      "deleted": true
    }
  }
}
```

---

#### 2. 刷新持久化测试

**测试步骤:**
1. 完成上述所有操作
2. 刷新页面 (F5)
3. 验证所有修改保留

**预期结果:**
- ✅ 自定义预设保留
- ✅ 内置预设修改保留
- ✅ 删除的预设仍然隐藏

---

## 边界情况测试

### 1. 删除所有预设

**测试步骤:**
1. 删除所有预设(内置 + 自定义)
2. 仅应显示"+"按钮

**预期结果:**
- ✅ 网格仅显示新增按钮
- ✅ 功能正常可用

---

### 2. 特殊字符处理

**测试步骤:**
1. 新增预设,名称包含特殊字符: `测试<>'"&平台`
2. 保存并验证

**预期结果:**
- ✅ 正常保存和显示
- ✅ 无 XSS 风险

---

### 3. 长 URL 处理

**测试步骤:**
1. 输入超长 URL (>100 字符)
2. 验证显示

**预期结果:**
- ✅ URL 使用 `truncate` 类截断
- ✅ 完整 URL 存储在数据中

---

## 集成测试

### 1. 选择预设填充 URL

**测试步骤:**
1. 点击任意预设卡片
2. 验证 API 地址输入框自动填充

**预期结果:**
- ✅ URL 正确填充
- ✅ 验证错误清除

---

### 2. 与历史记录功能兼容

**测试步骤:**
1. 使用自定义预设查询 API
2. 验证 URL 保存到历史记录

**预期结果:**
- ✅ 历史记录正常工作
- ✅ 两个功能不冲突

---

## 性能测试

### 1. 大量预设渲染

**测试步骤:**
1. 添加 20+ 个自定义预设
2. 观察渲染性能

**预期结果:**
- ✅ 无明显卡顿
- ✅ Hover 响应迅速

---

## 已知限制

1. **不支持拖拽排序** (YAGNI 原则)
2. **不支持图标/颜色定制** (保持简洁)
3. **不支持导入/导出** (未来扩展)

---

## 设计原则验证

### ✅ KISS (简单至上)
- 仅实现名称 + URL 字段
- UI 交互直观
- 无过度设计

### ✅ DRY (杜绝重复)
- 复用 `validateApiUrl` 验证器
- 复用 `HistoryDialog` 弹窗样式
- 统一的预设对象结构

### ✅ YAGNI (精益求精)
- 不实现拖拽排序
- 不实现导入/导出
- 专注核心功能

### ✅ SOLID
- **单一职责**: PresetDialog 仅负责表单,ApiForm 负责逻辑
- **开闭原则**: Override 机制扩展内置预设
- **依赖倒置**: 依赖 useStorage 抽象

---

## 测试完成检查表

- [ ] 新增预设功能
- [ ] 编辑内置预设
- [ ] 编辑自定义预设
- [ ] 删除内置预设
- [ ] 删除自定义预设
- [ ] 恢复默认功能
- [ ] 重名检测
- [ ] URL 验证
- [ ] 必填字段验证
- [ ] 响应式布局
- [ ] 动画过渡
- [ ] 数据持久化
- [ ] 刷新后保留
- [ ] 边界情况
- [ ] 集成兼容性

---

## 快速测试脚本 (浏览器控制台)

```javascript
// 查看当前存储的预设
JSON.parse(localStorage.getItem('platform-presets'))

// 重置所有预设 (恢复初始状态)
localStorage.removeItem('platform-presets')
location.reload()

// 添加测试数据
const testData = {
  custom: [
    {
      id: '1707012345-abc123',
      name: '测试平台 1',
      url: 'https://api.test1.com',
      isBuiltIn: false
    },
    {
      id: '1707012346-def456',
      name: '测试平台 2',
      url: 'https://api.test2.com',
      isBuiltIn: false
    }
  ],
  builtInOverrides: {
    'OpenAI 官方': { name: 'OpenAI (自定义)', url: 'https://api.openai.com' },
    '硅基流动': { deleted: true }
  }
}
localStorage.setItem('platform-presets', JSON.stringify(testData))
location.reload()
```

---

## 问题报告模板

如果发现问题,请记录:

1. **问题描述**: [详细描述]
2. **复现步骤**: [步骤列表]
3. **预期结果**: [应该发生什么]
4. **实际结果**: [实际发生什么]
5. **浏览器**: [Chrome/Firefox/Safari + 版本]
6. **控制台错误**: [错误信息截图]

---

## 功能实现状态

✅ Phase 1: 核心基础 - **已完成**
✅ Phase 2: 功能完善 - **已完成**
✅ Phase 3: 优化与测试 - **已完成**

🎉 **所有计划功能已实现!**

---

**测试开始时间**: [填写]
**测试完成时间**: [填写]
**测试人员**: [填写]
**测试结果**: [通过/失败]
